<!--
Google IO 2012 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahe <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title>Google IO 2012</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="all" href="theme/css/app.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

<!-- <slide class="logoslide nobackground">
  <article class="flexbox vcenter">
    <span><img src="images/google_developers_logo.png"></span>
  </article>
</slide>
 -->
<slide class="title-slide segue nobackground">
  <aside class="gdbar"><img src="images/logo.png"></aside>
  <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
  <hgroup class="auto-fadein">
    <h1 data-config-title><!-- populated from slide_config.json --></h1>
    <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
    <p data-config-presenter><!-- populated from slide_config.json --></p>
  </hgroup>
</slide>


<slide  >
  
    <hgroup>
      <h2>Why do we need Chef?</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
We need to build all this for the app to run.
</pre>

<p><img alt="app stack" src="images/infrastructure.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Why do we need Chef?</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
http://en.wikipedia.org/wiki/Software_configuration_management
Repeatable deployments
Consistent deployment across multiple platforms
Avoid snowflake servers
Infrastructure as code

Software Configuration Management concerns itself with answering the question "Somebody did something, how can one reproduce it?"
</pre>

<p><img alt="Blown-up version" src="images/blowed-up.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Why does Chef do this?</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
- With Chef, you write abstract definitions as source code to describe how you want each part of your infrastructure to be built, and then apply those descriptions to individual servers.
</pre>

<p><img alt="How it was done, vs now" src="images/bashvsruby.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>What is Chef?</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><ul>
<li>Chef is an open-source automation platform built for provisioning servers and automated deployment of applications and services.</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Core components of Chef</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><ul>
<li>Chef is made up of a few components<ul>
<li>Chef Server</li>
<li>Chef Client</li>
<li>Chef Workstation</li>
<li>Chef Solo</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Chef Server</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><ul>
<li>Chef server is the component that performs searches across nodes, serves cookbooks to clients, and manages certificates.</li>
</ul>
<p><img alt="picture of chef" src="images/chef-architecture.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Chef Client</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
Chef-client is the actual thing that executes the cookbooks
</pre>

<ul>
<li>Chef client communicates with the chef server, authenticates clients, and compiles and executes cookbooks on the clients. </li>
</ul>
<p><img alt="picture of chef" src="images/chef-architecture.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Chef Workstation</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><ul>
<li>Chef workstation uses Knife, a command line tool, to manipulate Chef constructs on the Chef Server.</li>
</ul>
<p><img alt="picture of chef" src="images/chef-architecture.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Chef Solo</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
Add picture to show chef-server and chef-client combined with things being thrown out to become chef-solo

To provide the raw execution of cookbook recipes, the complete cookbook needs to be present on the disk.
</pre>

<ul>
<li>Chef Solo is a more limited chef client that allows you to run cookbooks without a chef server.</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Cookbooks</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
make this stuff fly in
</pre>

<ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li>Metadata</li>
<li>Files </li>
<li>Librares</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Cookbooks</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
make this stuff fly in
</pre>

<ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li><a href="www.google.com">Recipes</a></li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li>Metadata</li>
<li>Files </li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Getting started with recipes</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
sequential
collection of resources
utilizes attributes
</pre>

<p>apache2/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">
  package "apache2"

  template "/etc/apache2/apache2.conf" do 
    user   "www-data"
    group  "www-data"
    mode   node["apache2"]["mode"]
    source "apache2.conf.erb"
  end

  service "apache2" do
    action :enable
  end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Attributes</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
make this stuff fly in
TODO: include Ohai slide
</pre>

<ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li><a href="www.google.com">Attributes</a></li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li>Metadata</li>
<li>Files </li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Attributes</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
Parameters to recipies 
node specific data
</pre>

<p>apache2/attributes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">
  default["apache2"]["user"] = "www-data"
  default["apache2"]["group"] = "www-data"
  default["apache2"]["mode"] = "0644"
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Attributes</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
</pre>

<p>apache2/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">
  package "apache2"

  template "/etc/apache2/apache2.conf" do 
    user   "www-data"
    group  "www-data"<b>
    mode   node["apache2"]["mode"]</b>
    source "apache2.conf.erb"
  end

  service "apache2" do
    action :enable
  end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li><a href="www.google.com">Resources</a></li>
<li><a href="www.google.com">Providers</a></li>
<li>Templates</li>
<li>Metadata</li>
<li>Files </li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
zypper, yum, apt, pkg-add, ips
service is running debian upstart vs chkconfig vs redhat service
</pre>

<p>apache2/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">
<b>package "apache2"</b>

  template "/etc/apache2/apache2.conf" do 
    user   "www-data"
    group  "www-data"
    mode   node["apache2"]["mode"]
    source "apache2.conf.erb"
  end

  service "apache2" do
    action :enable
  end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
zypper, yum, apt, pkg-add, ips
service is running debian upstart vs chkconfig vs redhat service
</pre>

<p><img alt="Providers for package" src="images/providers.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
service is running debian upstart vs chkconfig vs redhat service
</pre>

<p>apache2/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">

  package "apache2"

  template "/etc/apache2/apache2.conf" do 
    user   "www-data"
    group  "www-data"
    mode   node["apache2"]["mode"]
    source "apache2.conf.erb"
  end

<b>service "apache2"</b> do
    action :enable
  end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
zypper, yum, apt, pkg-add, ips
service is running debian upstart vs chkconfig vs redhat service
</pre>

<p><img alt="Providers for service" src="images/service_provider.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Lightweight Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><pre class="note">
  cookbook can have an LWRP with no recipes. 
  LWRPs require less ruby knowledge as they are built using chef's DSL
</pre>

<p><img alt="feather image" src="images/11.jpg" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Lightweight Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
</pre>

<p>cookbooks/opscode/resources/database.rb</p>
<pre class="prettyprint" data-lang="ruby">
actions :create, :delete

attribute :name, :kind_of => String, :name_attribute => true
attribute :type, :kind_of => String
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Lightweight Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">

</pre>

<p>cookbooks/opscode/providers/mysql.rb</p>
<pre class="prettyprint" data-lang="ruby">
action :create do
  execute "create database" do
    not_if "mysql -e 'show databases;' | grep #{new_resource.name}"
    command "mysqladmin create #{new_resource.name}"
  end
end

action :delete do
  execute "delete database" do
    only_if "mysql -e 'show databases;' | grep #{new_resource.name}"
    command "mysqladmin drop #{new_resource.name}"
  end
end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Lightweight Resources & Providers</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">

</pre>

<p>cookbooks/monkeynews-app/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">
opscode_database "monkeynews" do
  type      "innodb"
  action    :create
  provider  "opscode_mysql"
end 
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Templates</h2>
      <h3></h3>
    </hgroup>
    <article ><ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li><a href="www.google.com">Templates</a></li>
<li>Metadata</li>
<li>Files </li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Templates</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
note the apache2.conf.erb
</pre>

<p>apache2/templates/default/apache2.conf.erb
<pre class="prettyprint" data-lang="ruby">
ServerRoot &lt;%= node['apache']['dir'] %&gt;
PidFile    &lt;%= node['apache']['pid_file'] %&gt;
Timeout    &lt;%= node['apache']['timeout'] %&gt;
Include    &lt;%= node['apache']['dir'] %&gt;/conf.d/
Include    &lt;%= node['apache']['dir'] %&gt;/sites-enabled/
</pre></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Templates</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
</pre>

<p>apache2/recipes/default.rb</p>
<pre class="prettyprint" data-lang="ruby">

  package "apache2"

  template "/etc/apache2/apache2.conf" do 
    user   "www-data"
    group  "www-data"
    mode   node["apache2"]["mode"]
    <b>source "apache2.conf.erb"</b>
  end

  service "apache2" do
    action :enable
  end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Metadata</h2>
      <h3></h3>
    </hgroup>
    <article ><ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li><a href="www.google.com">Metadata</a></li>
<li>Files </li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Metadata</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
Version
</pre>

<p>apache2/metadata.rb</p>
<pre class="prettyprint" data-lang="ruby">
<b>name</b>             "apache2"
<b>maintainer</b>        "Opscode, Inc."
<b>maintainer_email</b>  "cookbooks@opscode.com"
<b>license</b>           "Apache 2.0"
<b>description</b>       "Installs and configures all aspects of apache2 using Debian style 
symlinks with helper definitions"
<b>long_description</b>  IO.read(File.join(File.dirname(__FILE__), 'README.md'))
<b>version</b>           "1.6.0"
<b>recipe</b>            "apache2", "Main Apache configuration"
%w{redhat centos scientific fedora debian ubuntu arch freebsd amazon}.each do |os|
  <b>supports</b> os
end
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Metadata</h2>
      <h3></h3>
    </hgroup>
    <article ><p>nagios/metadata.rb</p>
<pre class="prettyprint" data-lang="ruby">
<b>name</b>              "nagios"
<b>maintainer</b>        "Opscode, Inc."
<b>maintainer_email</b>  "cookbooks@opscode.com"
<b>license</b>           "Apache 2.0"
<b>description</b>       "Installs and configures Nagios server and the NRPE client"
<b>long_description</b>  IO.read(File.join(File.dirname(__FILE__), 'README.md'))
<b>version</b>           "4.0.0"

%w{ apache2 build-essential php nginx nginx_simplecgi }.each do |cb|
  <b>depends</b> cb
end
...
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Files</h2>
      <h3></h3>
    </hgroup>
    <article ><ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li>Metadata</li>
<li><a href="www.google.com">Files</a></li>
<li>Libraries</li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Files</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
- Often, you need to distribute files to your servers. The Files within a cookbook are where you can do just that.
</pre>

<p>mongodb/file/default/replicaset.json</p>
<pre class="prettyprint" data-lang="json">
{ "mongodb":
           { members: [
             "member1": "host1.corp.com:27017",
             "member2": "host2.corp.com:27017",
             "member3": "host3.corp.com:27017"]
           }
}
</pre>

<p>mongodb/recipes/replicaset.rb</p>
<pre class="prettyprint" data-lang="ruby">
...
cookbook_file "/tmp/replicaset.json" do
  source "replicaset.json"
end
...
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Libraries</h2>
      <h3></h3>
    </hgroup>
    <article ><ul>
<li>Cookbooks are Chef's fundamental units of distribution<ul>
<li>Recipes</li>
<li>Attributes</li>
<li>Resources</li>
<li>Providers</li>
<li>Templates</li>
<li>Metadata</li>
<li>Files</li>
<li><a href="www.google.com">Libraries</a></li>
</ul>
</li>
</ul></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Libraries</h2>
      <h3></h3>
    </hgroup>
    <article ><pre class="note">
Libraries allow you to include arbitrary Ruby code, either to extend Chef's language or to implement your own classes directly.
</pre>

<p>mongodb/libraries/mongodb.rb</p>
<pre class="prettyprint" data-lang="ruby">
<b>class Chef::Recipe::MongoDB
  def self.initialize_replicaset(replicaset_name, mongo_nodes, credentials)</b>
    require 'rubygems'
    require 'mongo'
    ...
    mongo_nodes.each do |mongo_node|
      bson_member = BSON::OrderedHash.new
      bson_member['_id'] = new_member_id
      new_member_id += 1
      bson_member['host'] = "#{mongo_node['fqdn']}:#{mongo_node['mongodb']['port']}"
      members << bson_member
    end 
    config['members'] = members
    ...
  <b>end
end</b>
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Libraries</h2>
      <h3></h3>
    </hgroup>
    <article ><p>mongodb/recipes/replicaset.rb</p>
<pre class="prettyprint" data-lang="ruby">
...
ruby_block "Initialize Replicaset" do
  block do
    Chef::Recipe::MongoDB.initialize_replicaset(...)
  end
end
...
</pre></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Big Picture</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><p><img alt="Big Picture" src="images/comprehensive_chef.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Anatomy of a Chef run</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><p><img alt="anatomy" src="images/chef-run.png" /></p></article>
 
</slide>

<slide  >
  
    <hgroup>
      <h2>Hands On Tutorial</h2>
      <h3></h3>
    </hgroup>
    <article class="flexbox vcenter"><p><a href="https://github.com/chef-tutorials/workstation">https://github.com/chef-tutorials/workstation</a></p></article>
 
</slide>


<slide class="thank-you-slide segue nobackground">
  <aside class="gdbar right"><img src="images/logo.png"></aside>
  <article class="flexbox vleft auto-fadein">
    <h2>&lt;Thank You!&gt;</h2>
  </article>
  <p class="auto-fadein" data-config-contact>
    <!-- populated from slide_config.json -->
  </p>
</slide>

<!-- <slide class="logoslide dark nobackground">
  <article class="flexbox vcenter">
    <span><img src="images/google_developers_logo_white.png"></span>
  </article>
</slide> -->

<slide class="backdrop"></slide>

</slides>

<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>